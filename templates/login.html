{% set activeMenuItem = 4 %}
{% extends "layout.html" %}
{% block body %}
<!--LOAD PRE-REQUISITES FOR GOOGLE SIGN IN -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="//apis.google.com/js/platform.js?onload=start"> </script>
<!-- END PRE-REQUISITES FOR GOOGLE SIGN IN -->

<!-- LOAD PRE-REQUISITES FOR FACEBOOK SIGN IN -->
<!-- TODO: Implement later facebook SDK via jQuery: https://developers.facebook.com/docs/javascript/howto/jquery/v2.11 -->
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '384661528649662',
      cookie     : true,
      xfbml      : true,
      version    : 'v2.7'
    });

    FB.AppEvents.logPageView();

  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "https://connect.facebook.net/de_DE/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk')
 );

	// Here we run a very simple test of the Graph API after login is
	// successful.  See statusChangeCallback() for when this call is made.
	function signInCallbackFB() {
		var access_token = FB.getAuthResponse()['accessToken'];
		console.log(access_token)
		console.log('Welcome!  Fetching your information.... ');
		FB.api('/me', function(response) {
			console.log('Successful login for: ' + response.name);
		 $.ajax({
			type: 'POST',
			url: '/fbconnect?state={{STATE}}',
			processData: false,
			data: access_token,
			contentType: 'application/octet-stream; charset=utf-8',
			success: function(result) {
				// Handle or verify the server response if necessary.
				if (result) {
					$('#result').html('Login Successful!</br>'+ result + '</br>Redirecting...')
				 setTimeout(function() {
					window.location.href = "/";
				 }, 4000);

			} else {
				$('#result').html('Failed to make a server-side call. Check your configuration and console.');
				 }
			}

		});
		});
	}
</script>


</script>
<!-- END PRE-REQUISITES FOR FACEBOOK SIGN IN -->

<main>
  <!-- GOOGLE PLUS SIGN IN BUTTON-->
	<div style="height: 68px">

	</div>
	<div id="signinButton">
    <span class="g-signin"
      data-scope="openid email"
      data-clientid="{{CLIENT_ID}}"
      data-redirecturi="postmessage"
      data-accesstype="offline"
      data-cookiepolicy="single_host_origin"
      data-callback="signInCallbackGoogle"
      data-approvalprompt="force">
    </span>
  </div>

	<div id="result"></div>

	<script>
		function signInCallbackGoogle(authResult) {
		  if (authResult['code']) {
		    // Hide the sign-in button now that the user is authorized
		    $('#signinButton').attr('style', 'display: none');
		    // Send the one-time-use code to the server, if the server responds, write a 'login successful' message to the web page and then redirect back to the main restaurants page
		    $.ajax({
		      type: 'POST',
		      url: '/gconnect?state={{STATE}}',
		      processData: false,
		      data: authResult['code'],
		      contentType: 'application/octet-stream; charset=utf-8',
		      success: function(result) {
		        // Handle or verify the server response if necessary.
		        if (result) {
		          $('#result').html('Login Successful!</br>'+ result + '</br>Redirecting...')
		         setTimeout(function() {
		          window.location.href = "/";
		         }, 4000);

		      } else if (authResult['error']) {
		    console.log('There was an error: ' + authResult['error']);
		  } else {
		        $('#result').html('Failed to make a server-side call. Check your configuration and console.');
		         }
		      }

		  }); } }
	</script>
	<!--END GOOGLE PLUS SIGN IN BUTTON -->

	<!-- START Facebook login button -->

	<div class="fb-login-button"
	     data-max-rows="1"
			 data-size="medium"
			 data-button-type="continue_with"
			 data-show-faces="false"
			 data-auto-logout-link="true"
			 data-use-continue-as="false"
			 scope="public_profile,email"
		   onlogin="signInCallbackFB();">
	</div>
	<!-- END Facebook login button -->

</main>
{% endblock %}
